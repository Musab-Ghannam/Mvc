@model Tuple<List<mainMasterpiesce.Models.doctor>, List<mainMasterpiesce.Models.appointment>>


@{
    ViewBag.Title = "NotAvailable";
    Layout = "~/Views/Shared/_DoctorDashboard.cshtml";
}


    <style>



        .days {
            background-color: transparent;
            border: none;
            display: block;
            margin-left: 30px;
            font-weight: bold;
            padding: 10px;
        }
    </style>
    <div class="col-md-7 col-lg-8 col-xl-9">

        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Schedule Timings</h4>
                        <div class="profile-box">
                            <div class="row">

                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label>Timing Slot Duration</label>
                                        @*<select class="select form-control">
                                                <option>-</option>
                                                <option>15 mins</option>
                                                <option selected="selected">30 mins</option>
                                                <option>45 mins</option>
                                                <option>1 Hour</option>
                                            </select>*@
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card schedule-widget mb-0">

                                        <!-- Schedule Header -->
                                        <!--<div class="schedule-header">-->
                                        <!-- Schedule Nav -->
                                        @*<div class="schedule-nav">
                                                <ul class="nav nav-tabs nav-justified">
                                                    <li class="left-arrow" style="margin-top:12px">
                                                        <input type="hidden" name="arrow" />
                                                        <a href="@Url.Action("minusWeek", "DoctorEnrolling", new {  arrow = "left" })">
                                                            <i class="fa fa-chevron-left"></i>

                                                        </a>
                                                    </li>
                                                    @using (Html.BeginForm("NotAvailable", "DoctorEnrolling", FormMethod.Post))
                                                    {






                                                        for (int i = ViewBag.weeks; i < ViewBag.weeks + 7; i++)
                                                        {
                                                            if (i < 0)
                                                            {


                                                                break;
                                                            }




                                                            if (ViewBag.currentday == @DateTime.Now.AddDays(i).ToString("dd/MM/yy"))
                                                            {



                                                                <li>
                                                                    <input class="nav-link" type="submit" name="day" value="@DateTime.Now.AddDays(i).ToString("dddd")" style="@ViewBag.InputStyle" />
                                                                </li>
                                                                <li>

                                                                    <input class="nav-link" type="submit" name="day" value="@DateTime.Now.AddDays(i).ToString("dd/MM/yy")" style="@ViewBag.InputStyle" />
                                                                </li>




                                                            }
                                                            else
                                                            {




                                                                <li style="margin-left:16px">
                                                                    <input class="nav-link" type="submit" name="day" value="@DateTime.Now.AddDays(i).ToString("dd/MM/yy")" />

                                                                </li>
                                                            }
                                                        }



                                                    }



                                                    <li class="right-arrow" style="margin-left:25px;align-items:center;margin-top:14px">

                                                        <a href="@Url.Action("plusweeks", "DoctorEnrolling", new {  arrow = "left" })">
                                                            <i class="fa fa-chevron-right"></i>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>*@
                                        <!-- /Schedule Nav -->
                                        <!--</div>-->
                                        <!-- /Schedule Header -->
                                        <!-- Schedule Widget -->
                                        <div class="card booking-schedule schedule-widget">

                                            <!-- Schedule Header -->
                                            @{ 

                                                List<string> enabledButtons = new List<string>();
                                            }

                                       


                                            @using (Html.BeginForm("NotAvailable", "DoctorEnrolling", FormMethod.Post))
                                            {
                                                <div class="schedule-header">
                                                    <div class="row">
                                                        <div class="col-md-12">

                                                            <!-- Day Slot -->
                                                            <div class="day-slot">
                                                                <ul>
                                                                    <li class="left-arrow">
                                                                        <input type="hidden" name="arrow" />
                                                                        <a href="@Url.Action("minusWeek", "DoctorEnrolling", new { arrow = "left" })">
                                                                            <i class="fa fa-chevron-left"></i>
                                                                        </a>
                                                                        @{

                                                                            //int count = 0;
                                                                        }


                                                                        @for (int i = ViewBag.weeks; i < ViewBag.weeks + 7; i++)
                                                                        {
                                                                            if (i < 0)
                                                                            {
                                                                                break;
                                                                            }



                                                                            //if (ViewBag.flagsession) {

                                                                            //    ViewBag.currentday = Session["day"];
                                                                            //}
                                                                        <li>
                                                                            @*<a href="@Url.Action("determinday", "DoctorsInfo", new { doctorId = Model.doctor[0].doctorId })">*@
                                                                            @*<a href="determinday?doctorId=@Model.doctor[0].doctorId">*@
                                                                            @*ViewBag.currentday == @DateTime.Now.AddDays(i).ToString("dddd")&&*@
                                                                            @if (ViewBag.currentday == @DateTime.Now.AddDays(i).ToString("dd/MM/yy"))
                                                                            {
                                                                                <input class="days" type="submit" name="day" value="@DateTime.Now.AddDays(i).ToString("dddd")" style="@ViewBag.InputStyle" /> @*<span >@DateTime.Now.AddDays(i).ToString("dddd")</span>*@
                                                                                @*<span class="slot-date">@DateTime.Now.AddDays(i).ToString("dd/MM/yy")</span>*@
                                                                                <input class="days" type="submit" name="day" value="@DateTime.Now.AddDays(i).ToString("dd/MM/yy")" style="@ViewBag.InputStyle" />

                                                                            }
                                                                            else
                                                                            {


                                                                                <input class="days" type="submit" name="day" value="@DateTime.Now.AddDays(i).ToString("dddd")" /> @*<span >@DateTime.Now.AddDays(i).ToString("dddd")</span>*@
                                                                                @*<span class="slot-date">@DateTime.Now.AddDays(i).ToString("dd/MM/yy")</span>*@
                                                                                <input class="days" type="submit" name="day" value="@DateTime.Now.AddDays(i).ToString("dd/MM/yy")" />


                                                                            }



                                                                            @*</a>*@

                                                                        </li>

                                                                    }

                                                                        <li class="right-arrow">

                                                                            <a href="@Url.Action("plusweeks", "DoctorEnrolling", new { arrow = "left" })">
                                                                                <i class="fa fa-chevron-right"></i>
                                                                            </a>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                                <!-- /Day Slot -->

                                                            </div>
                                                        </div>
                                                    </div>}
                                            <!-- /Schedule Header -->
                                            <!-- Schedule Content -->
                                        <div class="schedule-cont">
                                            <div class="row">
                                                <div class="col-md-12">

                                                    <!-- Time Slot -->
                                                    <div class="time-slot">
                                                        <ul class="clearfix">


                                                            @{




                                                                List<string> reservedSlotsList = new List<string>();
                                                                foreach (var item in Model.Item2)
                                                                {
                                                                    string reservedSlot = item.starttime;
                                                                    reservedSlotsList.Add(reservedSlot);
                                                                    ViewBag.slotdatabase += reservedSlot + ',';
                                                                }

                                                                string[] reservedSlotsArray = reservedSlotsList.ToArray();









                                                                for (int i = 0; i < reservedSlotsArray.Length; i++)
                                                                {
                                                                    string slot = reservedSlotsArray[i];
                                                                    if (!string.IsNullOrEmpty(slot))
                                                                    {

                                                                        string reserveddate = slot.Substring(slot.Length - 5);


                                                                        string timereserved = slot.Substring(0, slot.Length - 5);
                                                                        @*<h1>@reserveddate,@timereserved</h1>*@

                                                                    }



                                                                }




                                                            }




                                                            @using (Html.BeginForm("NotAvailable", "DoctorEnrolling", FormMethod.Post))
                                                            {


                                                                {
                                                                    if (ViewBag.flag)
                                                                    {




                                                                        for (int hour = 8; hour <= 17; hour++)
                                                                        {
                                                                            DateTime dateTime = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day, hour, 0, 0);


                                                                            if (DateTime.Now.ToString("dd/MM/yy") == ViewBag.currentday)
                                                                            {


                                                                                if (DateTime.Now.TimeOfDay <= TimeSpan.FromHours(23))
                                                                                {
                                                                                    int inc = 0;
                                                                                    for (int i = DateTime.Now.Hour; i < 23; i++)
                                                                                    {
                                                                                        inc++;
                                                                                        DateTime dateTimtoday = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day, @DateTime.Now.AddHours(inc).Hour, 0, 0);
                                                                                        string formm = dateTimtoday.ToString("h:mm tt");
                                                                                        string datt = dateTimtoday.ToString("dd/MM//yy");

                                                                                        if (formm == "2:00 PM")
                                                                                        {
                                                                                            formm = formm.Replace("PM", "pm");


                                                                                        }




                                                                                        <li>




                                                                                            <span>




                                                                                                @{


                                                                                                    if (ViewBag.btn != null && ViewBag.slotdatabase != null)
                                                                                                    {


                                                                                                        if (!string.IsNullOrEmpty(ViewBag.slotdatabase))
                                                                                                        {

                                                                                                            if (ViewBag.slotdatabase.Contains(formm + ViewBag.currentday.Substring(0, 5) + ',') && !ViewBag.btn.Contains(formm + ViewBag.currentday.Substring(0, 5) + ','))
                                                                                                            {
                                                                                                                <input type="submit" value="@formm" name="btnn" id="myInput" class="days timing new" style="margin-top: 20PX; background-color: red;color:white" disabled />

                                                                                                            }


                                                                                                        }







                                                                                                        if (ViewBag.btn.Contains(formm + ViewBag.currentday.Substring(0, 5) + ',') && !ViewBag.slotdatabase.Contains(formm + ViewBag.currentday.Substring(0, 5) + ','))
                                                                                                        {


                                                                                                            <input type="submit" value="@formm" name="btnn" id="myInput" class="days timing new" style="margin-top: 20PX; background-color: #20BBBD;color:white" disabled />
                                                                                                        }





                                                                                                        else if (!ViewBag.btn.Contains(formm + ViewBag.currentday.Substring(0, 5) + ',') && !ViewBag.slotdatabase.Contains(formm + ViewBag.currentday.Substring(0, 5) + ','))
                                                                                                        {


                                                                                                            <input id="testt" type="submit" value="@formm" name="btnn" class="days timing new @ViewBag.inputClass" style="margin-top:20PX " />
                                                                                                        }










                                                                                                    }
                                                                                                    else
                                                                                                    {


                                                                                                        <input id="testt" type="submit" value="@formm" name="btnn" class="days timing new @ViewBag.inputClass" style="margin-top:20PX" />


                                                                                                    }









                                                                                                }










                                                                                            </span>


                                                                                        </li>


                                                                                    }
                                                                                    break;
                                                                                }


                                                                            }
                                                                            else
                                                                            {



                                                                                string datt = dateTime.ToString("dd/MM//yy");
                                                                                //DateTime dateTim = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day, 8, 0, 0);
                                                                                string formattedTime = dateTime.ToString("h:mm tt");
                                                                                //DateTime time = DateTime.ParseExact(formattedTime, "h:mm tt", CultureInfo.InvariantCulture);



                                                                                if (formattedTime == "2:00 PM")
                                                                                {
                                                                                    formattedTime = formattedTime.Replace("PM", "pm");


                                                                                }























                                                                                //return Content(formattedTime);
                                                                                <li>



                                                                                    @{ bool isClicked = false;
                                                                                        if (!string.IsNullOrEmpty(Request.Form["btnn"]))
                                                                                        {
                                                                                            isClicked = true;
                                                                                        }}

                                                                                    <span>
                                                                                        @*<input type="submit" value="@formattedTime" name="btnn" class="days timing new  " style="margin-top:20PX " />*@

                                                                                        @*<input type="submit" value="@formattedTime" name="btnn" class="days timing new" style="margin-top:20PX; background-color: @(isClicked ? "red" : "white"); pointer-events: @(isClicked ? "none" : "auto");" />*@

                                                                                        @{
                                                                                            if (ViewBag.btn != null && ViewBag.slotdatabase != null)
                                                                                            {


                                                                                                if (!string.IsNullOrEmpty(ViewBag.slotdatabase))
                                                                                                {
                                                                                                    if (ViewBag.slotdatabase.Contains(formattedTime + ViewBag.currentday.Substring(0, 5) + ',') && !ViewBag.btn.Contains(formattedTime + ViewBag.currentday.Substring(0, 5) + ','))
                                                                                                    {




                                                                                                        <input type="submit" value="@formattedTime" name="btnn" id="myInput" class="days timing new" style="margin-top: 20PX; background-color: red;color:white" disabled />


                                                                                                    }
                                                                                                }



                                                                                                if (ViewBag.btn.Contains(formattedTime + ViewBag.currentday.Substring(0, 5) + ',') || ViewBag.btn.Contains(formattedTime + ViewBag.currentday.Substring(0, 5) + '.') && !ViewBag.slotdatabase.Contains(formattedTime + ViewBag.currentday.Substring(0, 5) + ','))
                                                                                                {








                                                                                                    <input type="submit" value="@formattedTime" name="btnn" id="myInput" class="days timing new" style="margin-top: 20PX; background-color: #20BBBD;color:white" disabled />
                                                                                                }




                                                                                                else if (!ViewBag.btn.Contains(formattedTime + ViewBag.currentday.Substring(0, 5) + ',') && !ViewBag.slotdatabase.Contains(formattedTime + ViewBag.currentday.Substring(0, 5) + ','))
                                                                                                {



                                                                                                    <input type="submit" value="@formattedTime" name="btnn" id="myInput" class="days timing new" style="margin-top:20PX" />

                                                                                                    enabledButtons.Add(formattedTime + ViewBag.currentday.Substring(0, 5));
























                                                                                                }










                                                                                            }
                                                                                            else
                                                                                            {


                                                                                                <input type="submit" value="@formattedTime" name="btnn" id="myInput" class="days timing new" style="margin-top:20PX" />
                                                                                                enabledButtons.Add(formattedTime + ViewBag.currentday.Substring(0, 5));


                                                        
















                                                                                            }





                                                                                            ViewBag.EnabledButtons = enabledButtons;
                                                                                            string enabledButtonsString = string.Join(".", enabledButtons);
                                                                                            ViewBag.EnabledButtonsString = enabledButtonsString;



                                                                                        }
                                                                                        @*<input type="submit" value="@formattedTime" name="btnn" id="myInput" class="days timing new" style="margin-top:20PX;" />*@
                                                                                    </span>




                                                                                </li>



                                                                            }




                                                                        }
                                                                    }


                                                                }




                                                            }





                                                        </ul>


                                                    </div>
                                                    <!-- /Time Slot -->

                                                </div>
                                            </div>
                                            <div>

                                                @{






                                                    int fullcountter = Convert.ToInt32(Session["fullcount"]);

                                                    int countter = Convert.ToInt32(Session["count"]);



                                                }

                                                @fullcountter

                                                @if (!string.IsNullOrEmpty(ViewBag.fulldisplay))
                                                {


                                                    var btnValues = ViewBag.fulldisplay.Split(new[] { "," }, StringSplitOptions.RemoveEmptyEntries);
                                                    using (Html.BeginForm("NotAvailable", "DoctorEnrolling", FormMethod.Post))
                                                    {




                                                        <div style="display:flex;justify-content:space-between;flex-wrap:wrap">


                                                            @for (int i = 0; i < fullcountter && i < btnValues.Length; i++)
                                                            {




                                                                <div style="position:relative;">




                                                                    @if (btnValues[i].Length > 15 && !string.IsNullOrEmpty(ViewBag.fulldisplay))
                                                                    {


                                                                        <input type="hidden" value="@btnValues[i]" name="valueToRemove" class="days timing new fa fa-times" style="font-size: 12px; border: none; position: absolute; right: -20px; top: 5px; background-color: transparent" />
                                                                        <button style="font-size:17px;border:none;position:absolute;right:0px;top:17px;background-color:transparent;color:white">X</button>

                                                                        <input type="submit" value="@btnValues[i].Substring(btnValues[i].Length - 5)" name="index" class="days timing new danger" style="@ViewBag.ButtonStyle;background-color:#d9534f;color:white;border-radius:5px;" />


                                                                    }






                                                                </div>


                                                            }



                                                        </div>

                                                    }


                                                }





                                                @if (Session["fulldisplay"]!=null)
                                                {
                                                    @Session["fulldisplay"]

                                                }

                                            </div>

                                            <h4 style="align-items:center;text-align:center;margin-top:50PX"><span style="background-color: #20BBBD; padding: 2px 7px; border-radius: 70%; margin-right: 7px">@Session["count"]</span>Slot is selected</h4>




























                                            @using (Html.BeginForm("fullday", "DoctorEnrolling", FormMethod.Post))
                                            {





                                                <input type="hidden" value="@ViewBag.EnabledButtonsString" name="wholeday" class="days timing new fa fa-times" style="font-size: 12px; border: none; position: absolute; right: -20px; top: 5px; background-color: transparent" />
                                                @*<button style="background-color: #d9534f; color: white; border-radius: 5px;border:none" class="btn btn-primary submit-btn" name="btnn">Full Day(@ViewBag.currentday)</button>*@
                                                
                                                <input style="background-color: #d9534f; color: white; border-radius: 5px;border:none" class="btn btn-primary submit-btn" type="submit" name="wholeday" value="Full Day(@ViewBag.currentday)" />
                                                
                                                
                                                
                                                
                                                
                                                
                                                
                                                
                                                
                                                
                                                
                                                
                                                }
                                        </div>
                                            <!-- /Schedule Content -->

                                        </div>
                                        <!-- /Schedule Widget -->
                                        <!-- Submit Section -->
                                        <div class="submit-section proceed-btn text-right">
                                            <a href="checkout.html" class="btn btn-primary submit-btn"> Not Available</a>
                                        </div>
                                        <!-- /Submit Section -->
                                        <!-- Schedule Content -->
                                        <div class="tab-content schedule-cont">

                                            <!-- Sunday Slot -->
                                            <div id="slot_sunday" class="tab-pane fade">
                                                <h4 class="card-title d-flex justify-content-between">
                                                    <span>Time Slots</span>
                                                    <a class="edit-link" data-toggle="modal"
                                                       href="#add_time_slot">
                                                        <i class="fa fa-plus-circle"></i> Add Slot
                                                    </a>
                                                </h4>
                                                <p class="text-muted mb-0">Not Available</p>
                                            </div>
                                            <!-- /Sunday Slot -->
                                            <!-- Monday Slot -->
                                            <div id="slot_monday" class="tab-pane fade show active">
                                                <h4 class="card-title d-flex justify-content-between">
                                                    <span>Time Slots</span>
                                                    <a class="edit-link" data-toggle="modal"
                                                       href="#edit_time_slot">
                                                        <i class="fa fa-edit mr-1"></i>Edit
                                                    </a>
                                                </h4>














                                                <!-- Slot List -->
                                                <div class="doc-times">
                                                    <div class="">

                                                        @if (!string.IsNullOrEmpty(ViewBag.btn))
                                                        {

                                                            var btnValues = ViewBag.btn.Split(new[] { "," }, StringSplitOptions.RemoveEmptyEntries);
                                                            using (Html.BeginForm("NotAvailable", "DoctorEnrolling", FormMethod.Post))
                                                            {




                                                                <div style="display:flex;justify-content:space-between;flex-wrap:wrap">


                                                                    @for (int i = 0; i < countter; i++)
                                                                    {




                                                                        <div style="position:relative;">












                                                                            @if (btnValues[i].Length >50 && !string.IsNullOrEmpty(ViewBag.EnabledButtonsString))
                                                                            {


                                                                                <input type="hidden" value="@ViewBag.EnabledButtonsString," name="valueToRemove" class="days timing new fa fa-times" style="font-size: 12px; border: none; position: absolute; right: -20px; top: 5px; background-color: transparent" />
                                                                                <button style="font-size:17px;border:none;position:absolute;right:0px;top:17px;background-color:transparent;color:white">X</button>

                                                                                <input type="submit" value="@ViewBag.EnabledButtonsString.Substring(@ViewBag.EnabledButtonsString.Length - 5)" name="index" class="days timing new danger" style="@ViewBag.ButtonStyle;background-color:#d9534f;color:white;border-radius:5px;" />


                                                                            }
                                                                            @if(btnValues[i].Length <15 )
                                                                            {


                                                                                <input type="hidden" value="@btnValues[i]," name="valueToRemove" class="days timing new fa fa-times" style="font-size: 12px; border: none; position: absolute; right: -20px; top: 5px; background-color: transparent" />
                                                                                <button style="font-size:17px;border:none;position:absolute;right:0px;top:17px;background-color:transparent;color:white">X</button>

                                                                                <input type="submit" value="@btnValues[i]" name="index" class="days timing new danger" style="@ViewBag.ButtonStyle;background-color:#d9534f;color:white;border-radius:5px;" />



                                                                            }





                                                                        </div>


                                                                    }



                                                                </div>

                                                            }


                                                        }



                                                    </div>


                                                </div>
                                                <!-- /Slot List -->

                                            </div>
                                            <!-- /Monday Slot -->
                                   

                                        </div>
                                        <!-- /Schedule Content -->

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
